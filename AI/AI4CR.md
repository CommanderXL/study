
工程 + AI 结合：

明确哪些能做，哪些不能做？

AI 优势：

* 强大的规则引擎（静态分析）；

| 类别      | 典型问题                                         | 检出示例                             |
| ------- | -------------------------------------------- | -------------------------------- |
| 语法 / 类型 | TS 编译失败、隐式 any、空值调用                          | `const x: string = null;`        |
| Lint 规则 | 未使用变量、== 与 ===、array-index key               | `eslint(no-unused-vars)`         |
| 安全      | dangerouslySetInnerHTML 无 sanitize、eval 用户输入 | `react/no-danger-with-children`  |
| 死代码     | import 了却没用、函数从未被调用                          | `import {a} from 'x'` 但 a 出现 0 次 |
| 循环依赖    | A → B → A                                    | `madge --circular` 输出循环依赖的结果       |

实际这些工作通过一些工程化的手段同样能发现；


* 概率模型：大量的代码训练数据，出现次数最多的写法当作“通用模式”或者是“通用的业务逻辑”来作为先验数据集；

| 特征组合                   | 先验频率 | 我的默认动作        |
| ---------------------- | ---- | ------------- |
| 金额字段 `/ 100`           | 92%  | ✅ 符合大部分代码的编写        |
| 金额字段 `/ 99`            | 3%   | 🟡“魔法数字 99？”  |
| 路由跳转前 `if (!user)` 先行判断是否登录过 | 88%  | ✅ 符合大部分代码的编写        |
| 路由跳转前无任何登录判断           | 12%  | 🟡“请确认是否允许游客” |

这些数字不是规则写死，而是模型在预训练语料里数出来的：

* 见过 1.2 亿个“分→元”写法 → / 100 概率 0.92
* 见过 0.9 亿个路由跳转 → 0.88 带有登录判断

先验概率 = “我还没看你的具体需求之前，全世界代码最常怎么写”；CR 时AI先用它当临时业务规则。


AI 局限：

语言规范层面的代码，容易被识别；

* 不会实际执行代码，而是通过一些静态分析+模式匹配，那么对于依赖真实的代码运行的场景来说有局限：
  * 环境、兼容性问题；
  * 渲染样式问题；
  * 条件分支、eventBus、provide/inject 等运行时代码；
* 业务规则；
  * 前后端的数据协议；(case 较多)
  * 不同系统间、上下游页面跳转的数据通信；
  * 在没有足够的业务场景输入的情况下，主要依赖训练数据的当中的通用规则来进行代码CR；
  * AI 知道这段代码的执行逻辑是什么，但是并不知道这个逻辑是否实际的业务需求；

对于 AI 局限，有哪些辅助手段能提升大模型 CR 的准确度呢？ -> 先筛选分类别，然后看对应的解法及ROI

* 代码 commit -> 变更摘要；
* 描述业务场景；-> 业务需求文档？
* 预处理一些代码内容，生成结构化的数据；
* 前后端接口类型定义，确保数据单一源；
* ...


实际的业务场景 case：

review 前的 prompt：

* 躁点（context太多，如何缩小代码评估范围）；
  * 代码改动的摘要&自打分&自截断
  * 哪些内容需要 review、哪些不需要被 review？
  * 前期的 prompt 内容（包含哪些？）
    * 数据兜底：Array，Object 等非简单数据类型，需要做兜底；避免访问到了非法数据结构上的方法，导致代码报错； (23,55,65,80)
      * 实践：对于弱语言类型，虽然有 ts 做类型保护，但是运行时无法保证真实的数据结构，因此对于来自外部的数据都需要做兜底（例如函数接受到的参数，业务后端返回的数据等）；
    * 数据解构：必须是 Object（不管是函数体内部还是函数的签名），需要做数据兜底；(28)
    * 跨域问题：对于公共拦截器的修改，导致部分未处理的接口跨域；（114, 164, 86 - 依赖的第三方库添加了自定义头）
    * 处理url：(50, 67)
    * 拼写错误：lng，lat 等；（38）
    * 逻辑
      * 防重点击
* 覆盖率不足，例如一次pr改动了34个文件，但是agent是基于关键词挑出了6个文件（占比18%）

BitsCR - 哪些不需要做，前期重精确度，建立信心；

前期先把

验证报告：

* 验证标准（是否命中，top-3命中率）；
* 编译和运行时问题；
  * 运行时：
    * 语法规范：非简单类型的数据结构使用是否合法：Array、Object、解构等不符合预期的操作，即使是 ts 已经约束过了也需要保证没数据访问是合法的；
* 前端框架，vue/mpx/react 等通过静态编译 -> tree-sitter/joern 等工具的使用；
* tree-sitter ->  vue 等项目，逻辑表达


